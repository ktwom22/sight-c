<!DOCTYPE html>
<html>
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8WQ2J22B9Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8WQ2J22B9Z');
</script>
  <meta charset="utf-8">
  <title>ğŸ¯ GeoGuesser Results</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f6fa; color: #333; text-align: center; margin: 0; padding: 20px; }
    h1 { font-size: 1.8em; margin-bottom: 15px; }
    .result-box { background: #fff; max-width: 400px; margin: 0 auto 20px; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .score { font-size: 1.5em; font-weight: 600; margin-bottom: 12px; }
    .round-bars { font-size: 1.3em; margin-bottom: 10px; line-height: 1.5; }
    .copy-btn, .submit-btn, .freeplay-btn, .leaderboard-btn { margin-top: 10px; padding: 8px 20px; border-radius: 6px; font-size: 0.95em; cursor: pointer; border: none; font-weight: 500; }
    .copy-btn { background: #3498db; color: #fff; }
    .copy-btn:hover { background: #2980b9; }
    .submit-btn { background: #1abc9c; color: #fff; }
    .submit-btn:hover { background: #16a085; }
    .freeplay-btn { background: #27ae60; color: #fff; }
    .freeplay-btn:hover { background: #1e8449; }
    .leaderboard-btn { background: #f39c12; color: #fff; }
    .leaderboard-btn:hover { background: #d35400; }
    input[type="email"] { padding: 6px; width: 65%; border-radius: 6px; border: 1px solid #ccc; font-size: 0.95em; }
    .prompt { font-size: 0.9em; color: #555; margin-top: 8px; }
    #leaderboard { background: #fff; max-width: 400px; margin: 20px auto; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: none; }
    #leaderboard table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    #leaderboard th, #leaderboard td { padding: 6px 8px; font-size: 0.9em; }
    #leaderboard th { background: #3498db; color: #fff; border-radius: 6px; }
    #leaderboard tr.highlight { background: #d1f2eb; font-weight: 600; }
  </style>
</head>
<body>

  <h1>ğŸ Your Results</h1>

  <div class="result-box">
    <div class="score">Total Score: {{ total_score }}</div>
    <div class="round-bars">
      {% for r in results %}
        {{ r.bar }}<br>
      {% endfor %}
    </div>
    <div class="note">Distance bars show how close your guesses were each round.</div>

    <button class="copy-btn" onclick="copyShare()">ğŸ“‹ Copy Results</button>

    <div id="action-section">
      {% if not user_email %}
        <form method="POST" action="{{ url_for('result') }}">
          <div class="prompt">Want to unlock Free Play? Submit your score!</div>
          <input type="email" name="email" placeholder="Enter your email" required>
          <button type="submit" class="submit-btn">Submit</button>
        </form>
      {% elif freeplay_unlocked %}
        <button class="freeplay-btn" onclick="window.location.href='/freeplay'">ğŸŒ Free Play</button>
        <button class="leaderboard-btn" onclick="document.getElementById('leaderboard').style.display='block';">ğŸ† Leaderboard</button>
      {% endif %}
    </div>
  </div>

  <!-- Leaderboard -->
  <div id="leaderboard">
    <h2>ğŸ† Daily Leaderboard</h2>
    <table>
      <tr>
        <th>Player</th>
        <th>Score</th>
      </tr>
      {% set user_display = user_email.split('@')[0] if user_email else "" %}
      {% for e in entries %}
        <tr {% if e.email.split('@')[0] == user_display %}class="highlight"{% endif %}>
          <td>{{ e.email.split('@')[0] }}</td>
          <td>{{ e.score }}</td>
        </tr>
      {% endfor %}
    </table>
    <button onclick="document.getElementById('leaderboard').style.display='none';">Close</button>
  </div>


  <textarea id="share-text" style="display:none;">
ğŸŒ GeoGuesser Results
{% for r in results %}
{{ r.bar }}
{% endfor %}
ğŸ Total Score: {{ total_score }}
  </textarea>

<script>
  function copyShare() {
    const shareText = document.getElementById('share-text').value;
    navigator.clipboard.writeText(shareText).then(() => { alert("âœ… Results copied to clipboard!"); });
  }

  // Auto-show leaderboard if email already submitted
  {% if user_email %}
    document.getElementById('leaderboard').style.display = 'block';
  {% endif %}
</script>

</body>
</html>
