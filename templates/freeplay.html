<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåç SightCR Free Play</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8WQ2J22B9Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8WQ2J22B9Z');
</script>

<style>
html, body { margin:0; padding:0; height:100%; font-family: Arial, sans-serif; overflow:hidden; background:#f4f4f4; }
body { display:flex; flex-direction:column; }

header { text-align:center; padding:10px; }
h1 { margin:0; }

#street-view { flex:1; width:100%; height:100vh; }

#map-container {
    position: fixed; bottom:0; left:0; width:100%;
    height:30px; max-height:50%;
    background:white; border-top:3px solid #28a745;
    border-radius:12px 12px 0 0; overflow:hidden;
    transition: height 0.3s ease; box-shadow:0 -2px 10px rgba(0,0,0,0.2);
    z-index:5;
}
#map-header { cursor:pointer; background:#28a745; color:#fff; padding:8px; font-weight:bold; text-align:center; user-select:none; }
#map-arrow { display:inline-block; transition: transform 0.3s ease; }
#map { width:100%; height:calc(100% - 30px); }

#submit-btn {
    display:none;
    position: fixed; bottom:40px; left:50%; transform:translateX(-50%);
    padding:14px 30px; font-size:18px; border-radius:8px; border:none;
    background-color:#28a745; color:white; cursor:pointer; z-index:10;
}
#submit-btn:disabled { background-color:#aaa; cursor:not-allowed; }
#submit-btn:hover:enabled { background-color:#218838; }

/* Optional gamified bubbles */
.guess-bubble {
    position:absolute;
    background:#28a745; color:#fff;
    border-radius:50%; width:60px; height:60px;
    display:flex; justify-content:center; align-items:center;
    font-weight:bold; font-size:1.2em; box-shadow:0 4px 8px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<header>
  <h1>üåç Free Play</h1>
  <p>Click on the map to guess the location!</p>
</header>

<div id="street-view"></div>

<div id="map-container">
  <div id="map-header"><span id="map-arrow">‚¨ÜÔ∏è</span> Click to Expand / Collapse Map</div>
  <div id="map"></div>
</div>

<form method="POST" action="{{ url_for('freeplay_guess') }}">
  <input type="hidden" name="lat" id="guess-lat">
  <input type="hidden" name="lon" id="guess-lon">
  <button type="submit" id="submit-btn" disabled>Submit Guess</button>
</form>

<script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}"></script>
<script>
  // Street View
  var panorama = new google.maps.StreetViewPanorama(
      document.getElementById('street-view'), {
          position: {lat: {{ lat }}, lng: {{ lon }}},
          pov: {heading: {{ heading }}, pitch: 0},
          zoom: 1,
          motionTracking:false,
          panControl:false,
          addressControl:false,
          fullscreenControl:false,
          linksControl:false,
          showRoadLabels:false
      });

  // Map
  var map = new google.maps.Map(document.getElementById('map'), { center:{lat:0,lng:0}, zoom:2 });
  var guessMarker = null;

  map.addListener('click', function(event){
      if(guessMarker) guessMarker.setMap(null);
      guessMarker = new google.maps.Marker({position:event.latLng, map:map, label:"G"});
      document.getElementById('guess-lat').value = event.latLng.lat();
      document.getElementById('guess-lon').value = event.latLng.lng();
      document.getElementById('submit-btn').disabled = false;
      document.getElementById('submit-btn').style.display = 'block';
  });

  // Collapsible map
  var mapContainer = document.getElementById('map-container');
  var mapHeader = document.getElementById('map-header');
  var mapArrow = document.getElementById('map-arrow');
  var submitBtn = document.getElementById('submit-btn');
  var collapsed = true;

  mapHeader.addEventListener('click', function(){
      collapsed = !collapsed;
      mapContainer.style.height = collapsed ? '30px' : '40%';
      mapArrow.style.transform = collapsed ? 'rotate(0deg)' : 'rotate(180deg)';
      submitBtn.style.display = collapsed ? 'none' : 'block';
  });
</script>

</body>
</html>
