<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8WQ2J22B9Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8WQ2J22B9Z');
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ seo_title or "Round Result" }}</title>
  <meta name="description" content="{{ seo_description }}">
  <meta name="keywords" content="{{ seo_keywords }}">
  <meta name="robots" content="index, follow">

  <!-- Open Graph -->
  <meta property="og:title" content="{{ seo_title }}">
  <meta property="og:description" content="{{ seo_description }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ request.url }}">
  <meta property="og:image" content="{{ url_for('static', filename='images/geo-thumbnail.png', _external=True) }}">

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f8;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    .scoreboard {
      display: flex;
      justify-content: space-between;
      text-align: center;
      flex-wrap: nowrap;
      margin: 20px 0;
    }

    .scorebox {
      background: #ecf0f1;
      padding: 12px 15px;
      border-radius: 8px;
      flex: 1;
      margin: 0 5px;
    }

    .scorebox h2 {
      margin: 0;
      font-size: 16px;
      color: #7f8c8d;
    }

    .scorebox p {
      margin: 5px 0 0;
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
    }

    .distance-bar {
      font-size: 24px;
      text-align: center;
      margin: 15px 0;
    }

    #map {
      width: 100%;
      height: 350px;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      position: relative;
    }

    .map-overlay {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }

    .map-overlay a {
      display: inline-block;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: bold;
      color: #fff;
      text-decoration: none;
      transition: 0.3s;
    }

    .map-overlay .btn-next { background: #3498db; }
    .map-overlay .btn-next:hover { background: #2980b9; }
    .map-overlay .btn-final { background: #2ecc71; }
    .map-overlay .btn-final:hover { background: #27ae60; }

    @media (max-width: 768px) {
      .map-overlay a { font-size: 0.95rem; padding: 10px 18px; }
      .scorebox p { font-size: 16px; }
    }

    /* Expedia Banner */
    .expedia-banner { margin: 15px 0; text-align: center; }
  </style>
</head>
<body>

  <div class="container">
    <h1>Round {{ round }} Result</h1>

    <!-- One-line scoreboard -->
    <div class="scoreboard">
      <div class="scorebox">
        <h2>Distance</h2>
        <p>{{ result.distance_km }} km ({{ result.distance_mi }} mi)</p>
      </div>
      <div class="scorebox">
        <h2>Round Score</h2>
        <p>{{ result.round_score }}</p>
      </div>
      <div class="scorebox">
        <h2>Total Score</h2>
        <p>{{ score }}</p>
      </div>
    </div>

    <!-- Distance bar -->
    <div class="distance-bar">{{ result.bar }}</div>

    <!-- Expedia Banner BELOW distance bar and ABOVE map -->
    <div class="expedia-banner">
      <div class="eg-affiliate-banners"
           data-program="us-expedia"
           data-network="pz"
           data-layout="leaderboard"
           data-image="adventure"
           data-message="explore-world-travel"
           data-camref="1100l5uUXS"
           data-pubref=""
           data-link="home">
      </div>
      <script class="eg-affiliate-banners-script" src="https://creator.expediagroup.com/products/banners/assets/eg-affiliate-banners.js"></script>
    </div>

    <!-- Google Map -->
    <div style="position: relative;">
      <div id="map"></div>
      <div class="map-overlay">
        {% if round >= 3 %}
          <a href="{{ url_for('result') }}" class="btn-final">üèÅ See Final Results</a>
        {% else %}
          <a href="{{ url_for('index') }}" class="btn-next">‚û°Ô∏è Next Round</a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}"></script>
  <script>
    const guessedLat = {{ result.guessed_lat }};
    const guessedLng = {{ result.guessed_lon }};
    const actualLat = {{ result.actual_lat }};
    const actualLng = {{ result.actual_lon }};

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 4,
      center: { lat: (guessedLat + actualLat) / 2, lng: (guessedLng + actualLng) / 2 }
    });

    const guessMarker = new google.maps.Marker({
      position: { lat: guessedLat, lng: guessedLng },
      map,
      title: "Your Guess",
      icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
    });

    const actualMarker = new google.maps.Marker({
      position: { lat: actualLat, lng: actualLng },
      map,
      title: "Actual Location",
      icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
    });

    const line = new google.maps.Polyline({
      path: [
        { lat: guessedLat, lng: guessedLng },
        { lat: actualLat, lng: actualLng }
      ],
      geodesic: true,
      strokeColor: "#e74c3c",
      strokeOpacity: 1.0,
      strokeWeight: 3,
      map
    });

    const bounds = new google.maps.LatLngBounds();
    bounds.extend({ lat: guessedLat, lng: guessedLng });
    bounds.extend({ lat: actualLat, lng: actualLng });
    map.fitBounds(bounds);
  </script>
</body>
</html>
